<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DIAGNOSI - Fausto Fusetti</title>
    <style>
        body { font-family: sans-serif; background-color: #121212; color: white; text-align: center; padding: 20px; }
        #audio-start-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 100000; }
        #audio-start-content { border: 2px solid #0693e3; padding: 40px; border-radius: 20px; }
        #start-audio-btn { background: #0693e3; color: white; border: none; padding: 15px 30px; border-radius: 30px; font-size: 1.2em; cursor: pointer; }
    </style>
</head>
<body>
    <div id="audio-start-overlay">
        <div id="audio-start-content">
            <h2>Diagnosi in corso</h2>
            <p>Per favore, apri la console di debug e poi clicca il pulsante.</p>
            <button id="start-audio-btn">Avvia Test</button>
        </div>
    </div>
    <audio id="background-audio" loop src="7a-Controtempo-compresso.mp3"></audio>
    <h1 id="success-message" style="display: none;">Test Superato! L'audio è partito.</h1>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('[FASE 1] DOM Caricato. Lo script si sta avviando.');

    const startBtn = document.getElementById('start-audio-btn');
    const overlay = document.getElementById('audio-start-overlay');
    const audio = document.getElementById('background-audio');
    const successMessage = document.getElementById('success-message');

    if (!startBtn || !overlay || !audio) {
        console.error('[ERRORE CRITICO] Uno degli elementi base non è stato trovato!');
        alert('ERRORE CRITICO: Elementi non trovati. Controlla l\'HTML.');
        return;
    }
    console.log('[FASE 2] Elementi base trovati correttamente.');

    function runTest() {
        console.log('[FASE 3] Pulsante "Avvia Test" CLICCATO.');
        
        try {
            console.log('[FASE 4] Tento di eseguire audio.play()...');
            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log('%c[FASE 5 - SUCCESSO] La Promise di play() è stata risolta. L\'audio dovrebbe sentirsi.', 'color: lightgreen; font-weight: bold;');
                    overlay.style.display = 'none';
                    successMessage.style.display = 'block';
                }).catch(error => {
                    console.error('[FASE 5 - ERRORE] La Promise di play() è stata rigettata. Questo è il motivo del blocco.', error);
                    alert('TEST FALLITO: Il browser ha bloccato l\'audio. Controlla la console per l\'errore.');
                });
            } else {
                 console.warn('[FASE 4.5] Il browser non supporta le Promise su play(). Tento un avvio sincrono.');
                 audio.play();
                 overlay.style.display = 'none';
                 successMessage.style.display = 'block';
            }
        } catch (error) {
            console.error('[FASE 5 - ERRORE CATASTROFICO] Un errore imprevisto ha bloccato tutto durante il .play()', error);
            alert('TEST FALLITO: Errore catastrofico. Controlla la console.');
        }
    }

    startBtn.addEventListener('click', runTest);
    console.log('[FASE 2.5] Event listener collegato al pulsante.');
});
</script>
</body>
</html>
